<style>
  .modal-backdrop {
    position: unset;
  }
</style>

<div class="header-inverse">
  <h1 class="pull-left">
    Send a Mail
  </h1>
  <span class="pull-right">
    <div class="row" style="display: inline-block; margin-right: 150px; margin-top: -15px;">
      <label class="text-right col-form-label" style="display: inline; color: #fff; font-size: 16px;">Save to Activities</label>
      <div class="col-md-9 col-sm-8" style="display: inline">
        <input type="checkbox" name="head_office" data-render="switchery" data-theme="default" data-secondary-color="rgb(255, 91, 87)" data-change="check-switchery-state-same-office" />
      </div>
    </div>
    <button class="btn btn-danger btn-xs" onclick="window.history.back();">Discard</button>
    <button type="submit" class="btn btn-primary btn-xs" onclick="$('#mail_form').submit();">Send</button>
  </span>
</div>
<!-- begin vertical-box -->
<div class="vertical-box">
  <!-- begin vertical-box-row -->
  <div class="vertical-box-row bg-white">
    <%= form_tag('/carriers/send_mail', id: 'mail_form') do %>
      <!-- begin email to -->
      <div class="email-to">
        <label class="control-label">To:</label>
        <input name="to" id="email-to" class="primary line-mode" value="<%= @contacts %>">
        <input type="hidden" name="ids" value="<%= @ids %>">

      </div>
      <!-- end email to -->

      <div data-id="extra-cc"></div>

      <!-- begin email subject -->
      <div class="email-subject">
        <%= text_field_tag :subject, @subject, class: 'form-control form-control-lg', placeholder: "Subject" %>
      </div>
      <!-- end email subject -->
      <!-- begin email content -->
      <div class="email-content p-t-15">
        <%= hidden_field_tag :content, @content%>
        <%= text_area_tag(:content_body, nil, class: 'textarea form-control', id: "wysihtml5", placeholder: "Content here...", cols: 20, rows: 20) %>
      </div>
      <!-- end email content -->
      <div class="email-subject" style="padding-top: 2%;">
        <input type="checkbox" name="record_activity" data-render="switchery" data-theme="default" data-secondary-color="rgb(255, 91, 87)" />
        Record in Activity
      </div>
    <% end %>
  </div>
  <!-- end vertical-box-row -->
</div>
<!-- end vertical-box -->
<%= tinymce %>
<script language="javascript">
  var availableTags = [];
  console.log(availableTags);
  $(document).ready(function () {
     $('#wysihtml5').wysihtml5();
    $('#email-to').tagit({
      fieldName: 'to[]',
      availableTags: availableTags
    });
  });
  $(document).on('click', '[data-click="add-cc"]', function (e) {
    e.preventDefault();

    var targetName = $(this).attr('data-name');
    var targetId = 'email-cc-' + targetName + '';
    var targetHtml = '	<div class="email-to">		<label class="control-label">' + targetName + ':</label>		<ul id="' + targetId + '" class="primary line-mode"></ul>	</div>';
    $('[data-id="extra-cc"]').append(targetHtml);
    $('#' + targetId).tagit({
      fieldName: targetName.toLowerCase() + '[]',
      availableTags: availableTags
    });
    $(this).remove();
  });
</script>
