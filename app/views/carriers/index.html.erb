<style>
  .badge a {
    color: #fff!important;
  }
  td.link a:visited {
    color: #6f060b!important;
  }
</style>
<% if params[:controller] == "carriers" %>
  <style media="screen">
  .tooltip-inner {
    background-color: #6f060b!important;
  }
  .tooltip .arrow::before{
    border-right-color: #6f060b!important;
  }
  th {
    vertical-align: top;
  }
  th.rewrap {
    white-space: nowrap;
  }
  </style>
<% end %>
<!-- begin panel -->
<div style="width: 100%">
  <div class="panel panel-scout">
    <div class="panel-heading">
      <div class="panel-heading-btn">
        <button id="send-text-btn" class="btn btn-green btn-xs"><i class="fas fa-comment-alt"></i></button>
        <button id="send-mail-btn" class="btn btn-primary btn-xs"><i class="fas fa-envelope"></i></button>
      <%= link_to 'New Carrier', new_carrier_path, :class => 'btn btn-danger btn-xs' %>
      </div>
      <h4 class="panel-title lp-header">Carriers</h4>
    </div>
    <div class="panel-body">
      <table class="table table-striped table-bordered display"  data-order="[[3, &quot;asc&quot;]]" id="carrier_table" width="120%">
        <thead>
          <tr>
            <th></th>
            <th class="text-center"><i class="fas fa-clock"></i></th>
            <th class="rewrap">MC</th>
            <th class="rewrap">Name</th>
            <th class="rewrap">ST/PV</th>
            <th class="rewrap">Ops Name</th>
            <th class="rewrap">Ops Phone</th>
            <th width="12%">Ops Email</th>
            <th class="rewrap">Reef</th>
            <th width="20%">Lane</th>
            <th class="rewrap">Appr</th>
            <th class="rewrap">RO</th>
            <th class="rewrap">Class</th>
            <th class="rewrap">CR</th>
            <th class="text-center" class="rewrap">LstDateCon</th>
            <th class="rewrap">6M</th>
            <th class="rewrap">1M</th>
          </tr>
        </thead>
        <tfoot>
          <tr>
            <th></th>
            <th></th>
            <th class="rewrap">MC</th>
            <th class="rewrap">Name</th>
            <th class="rewrap">ST/PV</th>
            <th class="rewrap">Ops Name</th>
            <th class="rewrap">Ops Phone</th>
            <th width="12%">Ops Email</th>
            <th class="rewrap">Reef</th>
            <th width="20%">Lane</th>
            <th class="rewrap">Appr</th>
            <th class="rewrap">RO</th>
            <th class="rewrap">Class</th>
            <th class="rewrap">CR</th>
            <th class="rewrap">LstDateCon</th>
            <th class="rewrap">6M</th>
            <th class="rewrap">1M</th>
          </tr>
        </tfoot>
        <tbody class="spacer">
          <% @carriers.each do |carrier| %>
            <tr>
              <td><%= carrier.id %></td>
              <td>
                <% if carrier.reminders %>
                  <% carrier.reminders.each do |reminder| %>
                      <%= reminder_to_html(reminder).html_safe %>
                  <% end %>
                <% end %>
              </td>
              <td><%= carrier.mc_number %></td>
              <td class="link" nowrap>
                <span
                  data-toggle="tooltip"
                  data-placement="right"
                  data-html="true"
                  title="
                    <b>Name</b>: <%= carrier.company_name.blank? ? "(no name)" : carrier.company_name %><br>
                    <b>Ops Name</b>: <%= carrier.poc.nil? ? '' : carrier.poc.full_name %><br>
                    <b>Ops Phone</b>:
                      <%= carrier.poc.nil? ? '' : ((!carrier.poc.primary_phone.nil? && carrier.poc.primary_phone != "") ? (carrier.poc.primary_phone + ((!carrier.poc.primary_extension_number.nil? && carrier.poc.primary_extension_number != "") ? (", Ext. " + carrier.poc.primary_extension_number) : "") + ((carrier.poc.primary_phone_type != "") ? (" (#{(carrier.poc.primary_eligible_texting ? "TEXT" : carrier.poc.primary_phone_type)})") : "")) : "") %><br/>
                    <b>Ops Email</b>: <%= carrier.poc.nil? ? '' : carrier.poc.email.downcase %><br>
                    <b>Class</b>: <%= carrier.sales_priority %><br>
                    <b>MC Number</b>: <%= carrier.mc_number %><br>
                    <b>Reefers Count</b>: <%= carrier.reefers %><br>
                    <b>Sate/Province</b>: <%= carrier.location.nil? ? '' : carrier.location.state.upcase %><br>
                    <b>Last Contact Date</b>: <%= carrier.last_contact_date.nil? || carrier.last_contact_date.date_opened.nil? ? "" : carrier.last_contact_date.date_opened.strftime('%d/%m/%Y').to_s %><br>
                  ">
                  <%= link_to carrier.company_name.blank? ? "(no name)" : carrier.company_name, carrier %>
                </span>
              </td>
              <td><%= carrier.location.nil? ? '' : carrier.location.state.upcase %></td>
              <td nowrap><%= carrier.poc.nil? ? '' : carrier.poc.full_name %></td>
              <td nowrap><b>
                  <%= carrier.poc.nil? ? '' : ((!carrier.poc.primary_phone.nil? && carrier.poc.primary_phone != "") ? (carrier.poc.primary_phone + ((!carrier.poc.primary_extension_number.nil? && carrier.poc.primary_extension_number != "") ? (", Ext. " + carrier.poc.primary_extension_number) : "") + ((carrier.poc.primary_phone_type != "") ? (" (#{(carrier.poc.primary_eligible_texting ? "TEXT" : carrier.poc.primary_phone_type)})") : "")) : "") %></b></td>
              <td width="12%">
                <% if !carrier.poc.nil?  %>
                  <a href="mailto:<%= carrier.poc.email %>?Subject=Hello%20<%= carrier.poc.first_name.nil? ? '' :  carrier.poc.first_name.capitalize + " " + carrier.poc.last_name.capitalize  %>" target="_top">
                    <%= carrier.poc.email.downcase %>&nbsp;<i class="far fa-envelope"></i>
                  </a>
                <% end %>
              </td>
              <td class="text-center"><%= carrier.reefers %></td>
              <td width="20%">
                <% if carrier.carrier_lanes.length > 1 %>
                  <% carrier.lane_1.each do |lane| %>
                    <% if !lane.lane_origin.nil? && lane.lane_origin != "" %>
                      <% lane.lane_origin_to_array.each do |origin| %>
                        <% if Carrier::LIGHT_BLUE.include?(origin) %>
                          <span class="badge badge-primary"><%= link_to(origin, lane) %></span>
                        <% elsif Carrier::DARK_BLUE.include?(origin) %>
                          <span class="badge badge-drakblue"><%= link_to(origin, lane) %></span>
                        <% elsif Carrier::BLUE.include?(origin) %>
                          <span class="badge badge-info">
                            <% if origin == "NY-Brooklyn" %>
                              BKN
                            <% elsif origin == "NY-Bronx" %>
                              BXN
                            <% else %>
                              <%= link_to(origin, lane) %>
                            <% end %>
                          </span>
                        <% elsif Carrier::RED.include?(origin) %>
                        <span class="badge badge-danger"><%= link_to(origin, lane) %></span>
                        <% elsif Carrier::BROWN.include?(origin) %>
                          <span class="badge badge-brown">
                            <% if origin == "TX-McAllen" %>
                              MCT
                            <% else %>
                              <%= link_to(origin, lane) %>
                            <% end %>
                          </span>
                        <% elsif Carrier::YELLOW.include?(origin) %>
                          <span class="badge badge-yellow"><%= link_to(origin, lane) %></span>
                        <% elsif Carrier::ORANGE.include?(origin) %>
                          <span class="badge badge-warning">
                            <% if origin == "CA-Fresno" %>
                              FRC
                            <% elsif origin == "CA-Bakersfield" %>
                              BKC
                            <% elsif origin == "AZ-Yuma" %>
                              YUZ
                            <% else %>
                              <%= link_to(origin, lane) %>
                            <% end %>
                          </span>
                        <% elsif Carrier::GREEN.include?(origin) %>
                          <span class="badge badge-green"><%= link_to(origin, lane) %></span>
                        <% end %>
                      <% end %>
                      &rarr;
                    <% end %>
                    <% lane.lane_destination_to_array.each do |destination| %>
                      <% if Carrier::LIGHT_BLUE.include?(destination) %>
                        <span class="badge badge-primary"><%= link_to(destination, lane) %></span>
                      <% elsif Carrier::DARK_BLUE.include?(destination) %>
                        <span class="badge badge-drakblue"><%= link_to(destination, lane) %></span>
                      <% elsif Carrier::BLUE.include?(destination) %>
                        <span class="badge badge-info">
                          <% if destination == "NY-Brooklyn" %>
                            BKN
                          <% elsif destination == "NY-Bronx" %>
                            BXN
                          <% else %>
                            <%= link_to(destination, lane) %>
                          <% end %>
                        </span>
                      <% elsif Carrier::RED.include?(destination) %>
                      <span class="badge badge-danger"><%= link_to(destination, lane) %></span>
                      <% elsif Carrier::BROWN.include?(destination) %>
                        <span class="badge badge-brown">
                          <% if destination == "TX-McAllen" %>
                            MCT
                          <% else %>
                            <%= link_to(destination, lane) %>
                          <% end %>
                        </span>
                      <% elsif Carrier::YELLOW.include?(destination) %>
                        <span class="badge badge-yellow"><%= link_to(destination, lane) %></span>
                      <% elsif Carrier::ORANGE.include?(destination) %>
                        <span class="badge badge-warning">
                          <% if destination == "CA-Fresno" %>
                            FRC
                          <% elsif destination == "CA-Bakersfield" %>
                            BKC
                          <% elsif destination == "AZ-Yuma" %>
                            YUZ
                          <% else %>
                            <%= link_to(destination, lane) %>
                          <% end %>
                        </span>
                      <% elsif Carrier::GREEN.include?(destination) %>
                        <span class="badge badge-green"><%= link_to(destination, lane) %></span>
                      <% end %>
                    <% end %>
                    <br>
                  <% end %>
                <% else %>
                    <% lane = carrier.carrier_lanes.last %>
                    <% if !lane.nil? %>
                      <% if !lane.lane_origin.nil? && lane.lane_origin != "" %>
                        <% lane.lane_origin_to_array.each do |origin| %>
                          <% if Carrier::LIGHT_BLUE.include?(origin) %>
                            <span class="badge badge-primary"><%= link_to(origin, lane) %></span>
                          <% elsif Carrier::DARK_BLUE.include?(origin) %>
                            <span class="badge badge-drakblue"><%= link_to(origin, lane) %></span>
                          <% elsif Carrier::BLUE.include?(origin) %>
                            <span class="badge badge-info">
                              <% if origin == "NY-Brooklyn" %>
                                BKN
                              <% elsif origin == "NY-Bronx" %>
                                BXN
                              <% else %>
                                <%= link_to(origin, lane) %>
                              <% end %>
                            </span>
                          <% elsif Carrier::RED.include?(origin) %>
                          <span class="badge badge-danger"><%= link_to(origin, lane) %></span>
                          <% elsif Carrier::BROWN.include?(origin) %>
                            <span class="badge badge-brown">
                              <% if origin == "TX-McAllen" %>
                                MCT
                              <% else %>
                                <%= link_to(origin, lane) %>
                              <% end %>
                            </span>
                          <% elsif Carrier::YELLOW.include?(origin) %>
                            <span class="badge badge-yellow"><%= link_to(origin, lane) %></span>
                          <% elsif Carrier::ORANGE.include?(origin) %>
                            <span class="badge badge-warning">
                              <% if origin == "CA-Fresno" %>
                                FRC
                              <% elsif origin == "CA-Bakersfield" %>
                                BKC
                              <% elsif origin == "AZ-Yuma" %>
                                YUZ
                              <% else %>
                                <%= link_to(origin, lane) %>
                              <% end %>
                            </span>
                          <% elsif Carrier::GREEN.include?(origin) %>
                            <span class="badge badge-green"><%= link_to(origin, lane) %></span>
                          <% end %>
                        <% end %>
                        &rarr;
                      <% end %>
                    <% lane.lane_destination_to_array.each do |destination| %>
                      <% if Carrier::LIGHT_BLUE.include?(destination) %>
                        <span class="badge badge-primary"><%= link_to(destination, lane) %></span>
                      <% elsif Carrier::DARK_BLUE.include?(destination) %>
                        <span class="badge badge-drakblue"><%= link_to(destination, lane) %></span>
                      <% elsif Carrier::BLUE.include?(destination) %>
                        <span class="badge badge-info">
                          <% if destination == "NY-Brooklyn" %>
                            BKN
                          <% elsif destination == "NY-Bronx" %>
                            BXN
                          <% else %>
                            <%= link_to(destination, lane) %>
                          <% end %>
                        </span>
                      <% elsif Carrier::RED.include?(destination) %>
                      <span class="badge badge-danger"><%= link_to(destination, lane) %></span>
                      <% elsif Carrier::BROWN.include?(destination) %>
                        <span class="badge badge-brown">
                          <% if destination == "TX-McAllen" %>
                            MCT
                          <% else %>
                            <%= link_to(destination, lane) %>
                          <% end %>
                        </span>
                      <% elsif Carrier::YELLOW.include?(destination) %>
                        <span class="badge badge-yellow"><%= link_to(destination, lane) %></span>
                      <% elsif Carrier::ORANGE.include?(destination) %>
                        <span class="badge badge-warning">
                          <% if destination == "CA-Fresno" %>
                            FRC
                          <% elsif destination == "CA-Bakersfield" %>
                            BKC
                          <% elsif destination == "AZ-Yuma" %>
                            YUZ
                          <% else %>
                            <%= link_to(destination, lane) %>
                          <% end %>
                        </span>
                      <% elsif Carrier::GREEN.include?(destination) %>
                        <span class="badge badge-green"><%= link_to(destination, lane) %></span>
                      <% end %>
                    <% end %>
                  <% end %>
              <% end %>
              </td>
              <td class="text-center"><%= carrier.approved ? "<b class='text-success'>Y</b>".html_safe : "<i class='text-danger'>N</i>".html_safe %></td>
              <td class="text-center link"><%= carrier.relationship_owner_user.nil? ? '' : "#{link_to("#{carrier.relationship_owner_user.first_name[0]}#{carrier.relationship_owner_user.last_name[0]}", carrier.relationship_owner_user)}".html_safe %></td>
              <td class="text-center"><%= shade_sales_priority(carrier.sales_priority).html_safe %></td>
              <td class="text-center"><%= carrier.complete_record ? "<b class='text-success'>Y</b>".html_safe : "<i class='text-danger'>N</i>".html_safe %></td>
              <td class="text-center"><%= carrier.last_contact_date.nil? || carrier.last_contact_date.date_opened.nil? ? "" : carrier.last_contact_date.date_opened.strftime('%d/%m/%Y').to_s %></td>
              <td class="text-center"><%= carrier.load_last_6_month %></td>
              <td class="text-center"><%= carrier.load_last_month %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script language="javascript">
  $(document).ready(function() {
    filterAndSelectAllTable("carrier_table", 1);
    $('#send-mail-btn').on('click', function(){
        var rows_selected = $('#carrier_table').DataTable().column(0).checkboxes.selected();
        if (rows_selected.join(",") != ""){
          $.redirect('/carriers/compose_mail', {'ids': rows_selected.join(",")});
        }
    });
  });
</script>
