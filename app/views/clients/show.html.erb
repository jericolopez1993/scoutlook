
<style>
p {
  display: inline-block!important;
}
.hide {
  visibility: hidden;
}
@media (max-width: 767px) {
  .panel-inverse > .panel-heading {
    background: 0 0;
  }
  .md-nav {
    display: none;
  }
  .nav-pills .nav-link, .nav-pills > li > a {
    background-color: #fff;
    margin: 5px;
  }
  label {
    text-align: left!important;
  }
}
label {
  text-align: right;
}
</style>
<!-- begin page-header -->
<%= render 'layouts/static/header', header_title: 'Clients', sub_header_title: 'Create/Edit/View'%>
<!-- end page-header -->
<!-- begin row -->
<ul class="nav nav-pills d-md-none">
	<li class="nav-items text-center" style="width:100%;">
		<a href="#company-name" data-toggle="tab" class="nav-link active hide-btn">
			<span class="d-sm-none">General</span>
		</a>
	</li>
	<li class="nav-items text-center" style="width:50%; margin-left:-.5px;">
		<a href="#attachments" data-toggle="tab" class="nav-link hide-btn">
			<span class="d-sm-none">Attachments</span>
		</a>
	</li>
	<li class="nav-items text-center" style="width:50%; margin-left:-.5px;">
		<a href="#shipments" data-toggle="tab" class="nav-link hide-btn">
			<span class="d-sm-none">Shipments</span>
		</a>
	</li>
	<li class="nav-items text-center" style="width:50%; margin-left:-.5px;">
		<a href="#locations" data-toggle="tab" class="nav-link location-btn">
			<span class="d-sm-none">Locations</span>
		</a>
	</li>
  <li class="nav-items text-center" style="width:50%; margin-left:-.5px;">
    <a href="#contacts" data-toggle="tab" class="nav-link contact-btn">
      <span class="d-sm-none">Contacts</span>
    </a>
  </li>
  <li class="nav-items text-center" style="width:50%; margin-left:-.5px;">
    <a href="#activities" data-toggle="tab" class="nav-link activity-btn">
      <span class="d-sm-none">Activities</span>
    </a>
  </li>
  <li class="nav-items text-center" style="width:50%; margin-left:-.5px;">
    <a href="#rates" data-toggle="tab" class="nav-link rate-btn">
      <span class="d-sm-none">Rates</span>
    </a>
  </li>
</ul>
    <!-- begin panel -->

  <div class="panel panel-inverse">
    <div class="panel-heading" style="padding: 5px 15px">
      <div class="panel-heading-btn" style="margin-top: 2.5px;">
        <%= link_to 'New Location', new_client_location_path(:client_id => @client.id), :class => 'hide btn btn-primary btn-xs new-location-btn' %>
        <%= link_to 'New Contact', new_client_contact_path(:client_id => @client.id), :class => 'hide btn btn-primary btn-xs new-contact-btn' %>
        <%= link_to 'New Activity', new_activity_path(:client_id => @client.id, :previous_controller => params[:controller]), :class => 'hide btn btn-primary btn-xs new-activity-btn' %>
        <%= link_to 'New Rates', new_rate_path(:client_id => @client.id, :previous_controller => params[:controller]), :class => 'hide btn btn-primary btn-xs new-rate-btn' %>
        <%= link_to 'Edit', edit_client_path(@client), :class => 'btn btn-warning btn-xs' %>
        <%= link_to 'Back', clients_path, :class => 'btn btn-info btn-xs' %>
      </div>
    <ul class="nav nav-pills md-nav" style="margin-bottom: 0px;">
      <li class="nav-items">
        <a href="#company-name" data-toggle="tab" class="nav-link active show hide-btn" style="padding:5px; margin: 0px 10px">
          <span class="d-sm-block d-none"><h4 class="panel-title">General</h4></span>
        </a>
      </li>
      <li class="nav-items">
        <a href="#attachments" data-toggle="tab" class="nav-link hide-btn" style="padding:5px; margin: 0px 10px">
          <span class="d-sm-block d-none"><h4 class="panel-title">Attachments</h4></span>
        </a>
      </li>
      <li class="nav-items">
        <a href="#shipments" data-toggle="tab" class="nav-link hide-btn" style="padding:5px; margin: 0px 10px">
          <span class="d-sm-block d-none"><h4 class="panel-title"></h4>Shipments</span>
        </a>
      </li>
      <li class="nav-items">
        <a href="#locations" data-toggle="tab" class="nav-link location-btn" style="padding:5px; margin: 0px 10px">
          <span class="d-sm-block d-none"><h4 class="panel-title"></h4>Locations</span>
        </a>
      </li>
      <li class="nav-items">
        <a href="#contacts" data-toggle="tab" class="nav-link contact-btn" style="padding:5px; margin: 0px 10px">
          <span class="d-sm-block d-none"><h4 class="panel-title"></h4>Contacts</span>
        </a>
      </li>
      <li class="nav-items">
        <a href="#activities" data-toggle="tab" class="nav-link activity-btn" style="padding:5px; margin: 0px 10px">
          <span class="d-sm-block d-none"><h4 class="panel-title"></h4>Activities</span>
        </a>
      </li>
      <li class="nav-items">
        <a href="#rates" data-toggle="tab" class="nav-link rate-btn" style="padding:5px; margin: 0px 10px">
          <span class="d-sm-block d-none"><h4 class="panel-title"></h4>Rates</span>
        </a>
      </li>
    </ul>
    </div>

    <div class="tab-content">
    <!-- begin tab-pane -->
      <div class="tab-pane fade active show" id="company-name">
        <div class="panel-body">
            <div class="form-group row m-b-25">
            <h4 class="text-inverse">Details</h4>
          </div>
          <div class="form-group row m-b-15">
            <label class="col-md-2 col-form-label">Company Name:</label>
            <div class="col-md-9 lbl-padding-t">
              <%= @client.company_name %>
            </div>
          </div>
          <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">ID:</label>
           <div class="col-md-9 lbl-padding-t">
             <%= generate_alphanumeric_id(@client.company_name, @client.id) %>
           </div>
         </div>
         <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">Type:</label>
           <div class="col-md-9 lbl-padding-t">
             <%= @client.client_type %>
           </div>
         </div>
         <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">Rep's Name:</label>
           <div class="col-md-9 lbl-padding-t">
             <% if @client.relationship_owner.present? && !@client.relationship_owner.nil?%>
             <%= link_to "#{@client.rep.first_name} #{@client.rep.last_name} (#{generate_alphanumeric_id(@client.rep.last_name, @client.rep.id)})", rep_path(:id => @client.relationship_owner) %>
             <% end %>
           </div>
         </div>
         <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">Sales priority:</label>
           <div class="col-md-9 lbl-padding-t">
             <%= @client.sales_priority %>
           </div>
         </div>
         <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">Phone:</label>
           <div class="col-md-9 lbl-padding-t">
             <%= @client.phone %>
           </div>
         </div>
         <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">Annual Revenue:</label>
           <div class="col-md-9 lbl-padding-t">
             <%= @client.annual_revenue %>
           </div>
         </div>
         <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">Industry:</label>
           <div class="col-md-9 lbl-padding-t">
             <%= @client.industry %>
           </div>
         </div>
         <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">Primary Industry:</label>
           <div class="col-md-9 lbl-padding-t">
             <%= @client.primary_industry %>
           </div>
         </div>
         <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">Hazardous:</label>
           <div class="col-md-9 lbl-padding-t">
             <%= @client.hazardous %>
           </div>
         </div>
         <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">Food Grade:</label>
           <div class="col-md-9 lbl-padding-t">
             <%= @client.food_grade %>
           </div>
         </div>
         <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">Freight Revenue:</label>
           <div class="col-md-9 lbl-padding-t">
             <%= @client.freight_revenue %>
           </div>
         </div>
         <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">Credit Status:</label>
           <div class="col-md-9 lbl-padding-t">
             <%= @client.credit_status %>
           </div>
         </div>
         <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">Credit Approval:</label>
           <div class="col-md-9 lbl-padding-t">
             <%= @client.credit_approval %>
           </div>
         </div>
          <hr>
          <div class="form-group row m-b-25">
            <h4 class="text-inverse">Volume</h4>
          </div>
          <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">Intra:</label>
           <div class="col-md-9 lbl-padding-t">
             <%= @client.volume_intra %>
           </div>
         </div>
         <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">Inter:</label>
           <div class="col-md-9 lbl-padding-t">
             <%= @client.volume_inter %>
           </div>
         </div>
         <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">to USA:</label>
           <div class="col-md-9 lbl-padding-t">
             <%= @client.volume_to_usa %>
           </div>
         </div>
         <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">from USA:</label>
           <div class="col-md-9 lbl-padding-t">
             <%= @client.volume_from_usa %>
           </div>
         </div>
         <div class="form-group row m-b-15">
           <label class="col-md-2 col-form-label">Notes:</label>
           <div class="col-md-9 lbl-padding-t">
             <%= @client.notes.nil? ? "" : @client.notes.html_safe %>
           </div>
         </div>
        </div>
      </div>
      <div class="tab-pane fade" id="attachments">
        <div class="panel-body">
          <table id="data-table-buttons" class="table table-striped table-bordered data-table-no-buttons display nowrap" style="width:100%">
            <thead>
              <tr class="odd gradeX">
                <th width="1%"></th>
                <th class="text-nowrap">Name</th>
                <th class="text-nowrap">Date</th>
                <th class="text-nowrap" data-orderable="false"></th>
              </tr>
            </thead>
            <tbody>
              <% @client.attachment_file.each_with_index do |attachment_file, index| %>
              <tr>
                <td><%= attachment_file.id %></td>
                <td><%= attachment_file.filename %></td>
                <td><%= convert_date(attachment_file.created_at) %></td>
                <td>
                  <%= link_to '<i class="fas fa-download"></i>'.html_safe, rails_blob_path(attachment_file, disposition: 'preview'), :class => 'btn btn-primary  btn-xs' %>
                  <%= link_to '<i class="fas fa-trash-alt"></i>'.html_safe, remove_attachment_clients_path(:id => @client.id, :attachment_id => attachment_file.id), method: :delete, data: { confirm: 'Are you sure?' }, :class => 'btn btn-danger btn-xs'%>
                </td>
              </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
      <div class="tab-pane fade" id="shipments">
        <div class="panel-body">
          <%= render 'shipments', shipments: @client.shipments, client: @client %>
        </div>
      </div>
      <div class="tab-pane fade" id="locations">
        <div class="panel-body">
          <table id="data-table-buttons" class="table table-striped table-bordered data-table-buttons display nowrap" style="width:100%">
            <thead>
              <tr class="odd gradeX">
                <th width="1%">Primary</th>
                <th width="1%">#</th>
                <th class="text-nowrap">Name</th>
                <th class="text-nowrap">Type</th>
                <th class="text-nowrap">Address</th>
                <th class="text-nowrap">Phone</th>
                <th class="text-nowrap" data-orderable="false">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% ClientLocation.where(:client_id => @client.id).each do |client_location| %>
                <tr>
                  <td style="text-align: center;"><%= (@client.origin == client_location.id) ? '<span class="label label-warning">Origin</span><br/>'.html_safe : '' %>
                    <%= (@client.destination == client_location.id) ? '<span class="label label-danger">Destination</span><br/>'.html_safe : '' %>
                  <%= (@client.head_office == client_location.id) ? '<span class="label label-primary">Head Office</span><br/>'.html_safe : '' %></td>
                  <td><%= generate_alphanumeric_id(client_location.name, client_location.id) %></td>
                  <td><%= client_location.name %></td>
                  <td><%= client_location.loc_type %></td>
                  <td><%= client_location.same_ho ? (@client.head_office_location.nil? ? '' : (@client.head_office_location.location.nil? ? '' : "#{@client.head_office_location.location.address} #{@client.head_office_location.location.city} #{@client.head_office_location.location.state}, #{@client.head_office_location.location.country} #{@client.head_office_location.location.postal}")) : (client_location.location.nil? ? '' : "#{client_location.location.address} #{client_location.location.city} #{client_location.location.state}, #{client_location.location.country} #{client_location.location.postal}")%></td>
                  <td><%= client_location.same_ho ? (@client.head_office_location.nil? ? '' : @client.head_office_location.phone) : client_location.phone %></td>
                  <td>
                    <%= link_to '<i class="far fa-edit"></i>'.html_safe, edit_client_location_path(client_location), :class => 'btn btn-warning btn-xs' %>
                    <%= link_to '<i class="fas fa-trash-alt"></i>'.html_safe, client_location, method: :delete, data: { confirm: 'Are you sure?' }, :class => 'btn btn-danger btn-xs'%>
                  </td>

                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
      <div class="tab-pane fade" id="contacts">
        <div class="panel-body">
          <table id="data-table-buttons" class="table table-striped table-bordered data-table-buttons display nowrap" style="width:100%">
            <thead>
              <tr class="odd gradeX">
  							<th width="1%">Primary</th>
                <th class="text-nowrap">Name</th>
                <th class="text-nowrap">Email</th>
                <th class="text-nowrap">Address</th>
                <th class="text-nowrap">Work Phone</th>
                <th class="text-nowrap">Cell</th>
                <th class="text-nowrap">Social</th>
                <th class="text-nowrap" data-orderable="false">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% ClientContact.where(:client_id => @client.id).each do |contact| %>
                <tr>
                  <td style="text-align: center;"><%= (@client.pdm_id == contact.id) ? '<span class="label label-success">PDM</span><br/>'.html_safe : '' %>
                    <%= (@client.poc_id == contact.id) ? '<span class="label label-green">poc_id</span><br/>'.html_safe : '' %></td>
                  <td><%= contact.first_name.nil? ? '' :  contact.first_name + " " + contact.last_name  %></td>
                  <td><a href="mailto:<%= contact.email %>?Subject=Hello%20<%= contact.first_name.nil? ? '' :  contact.first_name + " " + contact.last_name  %>" target="_top"><%= contact.email %>&nbsp;<i class="far fa-envelope"></a></i></td>
                  <td><%= contact.same_ho ? (@client.head_office_location.nil? ? '' : (@client.head_office_location.location.nil? ? '' : "#{@client.head_office_location.location.address} #{@client.head_office_location.location.city} #{@client.head_office_location.location.state}, #{@client.head_office_location.location.country} #{@client.head_office_location.location.postal}")) : (contact.location.nil? ? '' : "#{contact.location.address} #{contact.location.city} #{contact.location.state}, #{contact.location.country} #{contact.location.postal}")%></td>
                  <td><%= contact.same_ho ? (@client.head_office_location.nil? ? '' : @client.head_office_location.phone) : contact.work_phone %></td>
                  <td><%= contact.home_phone %></td>
                  <td style="text-align: center;"><%= contact.linkedin_link.nil? ? "" : (link_to '<i class="fab fa-linkedin"></i>'.html_safe, contact.linkedin_link, :target => "_blank", :class => "social-links") %></td>
                  <td>
                    <a class="btn btn-warning btn-xs" href="<%= edit_client_contact_path(contact) %>"><i class="far fa-edit"></i></a>&nbsp;
                    <a data-confirm="Are you sure?" class="btn btn-danger btn-xs" rel="nofollow" data-method="delete" href="/client_contacts/<%= contact.id %>"><i class="far fa-trash-alt"></i></a>
                  </td>

                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
      <div class="tab-pane fade" id="activities">
        <div class="panel-body">
          <table id="data-table-buttons" class="table table-striped table-bordered data-table-buttons display nowrap" style="width:100%">
            <thead>
              <tr class="odd gradeX">
                <th width="1%">#</th>
                <th class="text-nowrap">Type</th>
                <th class="text-nowrap">Rep</th>
                <th class="text-nowrap">Annual Value</th>
                <th class="text-nowrap">Status</th>
                <th class="text-nowrap">Date Opened</th>
                <th class="text-nowrap">Date Closed</th>
                <th class="text-nowrap" data-orderable="false">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% Activity.where(:client_id => @client.id).each do |activity| %>
                <tr>
                  <td><%= generate_alphanumeric_id((activity.client.nil? ? "" : "#{activity.client.company_name}"), activity.id) %></td>
                  <td><%= activity.activity_type %></td>
                  <td><%= activity.rep_id %></td>
                  <td><%= activity.annual_value %></td>
                  <td><%= activity.status ? 'Open' : 'Closed' %></td>
                  <td><%= activity.date_opened %></td>
                  <td><%= activity.date_closed %></td>
                  <td>
                    <%= link_to '<i class="far fa-eye"></i>'.html_safe, activity_path(:id => activity.id, :previous_controller => params[:controller]), :class => 'btn btn-info btn-xs' %>
                    <%= link_to '<i class="far fa-edit"></i>'.html_safe, edit_activity_path(:id => activity.id, :previous_controller => params[:controller]), :class => 'btn btn-warning btn-xs' %>
                    <%= link_to '<i class="fas fa-trash-alt"></i>'.html_safe, activity_path(:id => activity.id, :previous_controller => params[:controller]), method: :delete, data: { confirm: 'Are you sure?' }, :class => 'btn btn-danger btn-xs'%>
                  </td>

                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
      <div class="tab-pane fade" id="rates">
        <div class="panel-body">
          <table id="data-table-buttons" class="table table-striped table-bordered data-table-buttons display nowrap" style="width:100%" >
            <thead>
              <tr class="odd gradeX">
                <th width="1%">#</th>
                <th class="text-nowrap">Level</th>
                <th class="text-nowrap">Rep</th>
                <th class="text-nowrap">Type</th>
                <th class="text-nowrap">Parent</th>
                <th class="text-nowrap" data-orderable="false">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% Rate.where(:client_id => @client.id).each do |rate| %>
                <tr>
                  <td><%= generate_alphanumeric_id(rate.rate_type, rate.id) %></td>
                  <td><%= rate.rate_level %></td>
                  <td><%= rate.rep.nil? ? "" : "#{generate_alphanumeric_id(rate.rep.last_name, rate.rep_id)}" %></td>
                  <td><%= rate.rate_type %></td>
                  <td><%= rate.parent.nil? ? "" : "#{generate_alphanumeric_id(rate.parent.rate_type, rate.parent_id)}" %></td>
                  <td>
                    <%= link_to '<i class="far fa-eye"></i>'.html_safe, rate_path(:id => rate.id, :previous_controller => params[:controller]), :class => 'btn btn-info btn-xs' %>
                    <%= link_to '<i class="far fa-edit"></i>'.html_safe, edit_rate_path(:id => rate.id, :previous_controller => params[:controller]), :class => 'btn btn-warning btn-xs' %>
                    <%= link_to '<i class="fas fa-trash-alt"></i>'.html_safe, rate_path(:id => rate.id, :previous_controller => params[:controller]), method: :delete, data: { confirm: 'Are you sure?' }, :class => 'btn btn-danger btn-xs'%>
                  </td>
                </tr>
              <% end %>

            </tbody>

          </table>
        </div>
      </div>
    <!-- end tab-pane -->
  </div>
</div>

<!-- end panel -->
<script type="text/javascript">
$('.location-btn').on('click', function(){
    $('.new-contact-btn, .new-rate-btn, .new-activity-btn').addClass('hide')
    $('.new-location-btn').removeClass('hide');
});
$('.contact-btn').on('click', function(){
    $('.new-location-btn, .new-rate-btn, .new-activity-btn').addClass('hide')
    $('.new-contact-btn').removeClass('hide');
});
$('.activity-btn').on('click', function(){
    $('.new-contact-btn, .new-rate-btn, .new-location-btn').addClass('hide')
    $('.new-activity-btn').removeClass('hide');
});
$('.rate-btn').on('click', function(){
    $('.new-contact-btn, .new-location-btn, .new-activity-btn').addClass('hide')
    $('.new-rate-btn').removeClass('hide');
});
$('.hide-btn').on('click', function(){
    $('.new-contact-btn, .new-location-btn, .new-activity-btn, .new-rate-btn').addClass('hide')
});
</script>
