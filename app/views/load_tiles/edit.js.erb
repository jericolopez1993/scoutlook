$("div#showLoad").find(".modal-body").html("<%= escape_javascript(render 'form', load_tile: @load_tile, form_id: 'edit_load') %>");
$("div#showLoad").find(".modal-title").text("Edit - <%= escape_javascript(@load_tile.name) %>")
$(".new-load-origin-multiple").select2({placeholder: "Select origins", allowClear: true, dropdownParent: $("#edit_load")});
$(".new-load-destination-multiple").select2({placeholder: "Select destinations", allowClear: true, dropdownParent: $("#edit_load")});
$(".new-load-origin-multiple").val(<%= raw @load_tile.origin_to_array %>).trigger("change");
$(".new-load-destination-multiple").val(<%= raw @load_tile.destination_to_array %>).trigger("change");
$("#showLoad").modal('show');

$(function () {
  var kanbanCol = $('.panel-body');
  kanbanCol.css('max-height', (window.innerHeight - 150) + 'px');

  var kanbanColCount = parseInt(kanbanCol.length);
  $('.container-fluid').css('min-width', (kanbanColCount * 350) + 'px');

  draggableInit();

  // $('.panel-heading').click(function() {     var $panelBody = $(this).parent().children('.panel-body');     $panelBody.slideToggle(); });
});

function addDateToForm(date) {
  $("#new_load").find("#last_load_date").datepicker('update', date);
  $("#newLoadForm").modal('show');
}

function draggableInit() {
  var sourceId;

  $('[draggable=true]').bind('dragstart', function (event) {
    sourceId = $(this).parent().attr('id');
    event.originalEvent.dataTransfer.setData("text/plain", event.target.getAttribute('id'));
  });

  $('.panel-body').bind('dragover', function (event) {
    event.preventDefault();
  });

  $('.panel-body').bind('drop', function (event) {
    var children = $(this).children();
    var targetId = children.attr('id');

    if (sourceId != targetId) {
      var elementId = event.originalEvent.dataTransfer.getData("text/plain");
      $('#processing-modal').modal('toggle'); //before post
      // Post data
      var element = document.getElementById(elementId);
      $.ajax({
        method: "PUT",
        url: "/api/load_tiles/"+$(element).data('id'),
        data: {
          load_date: $(this).data('date')
        }
      }).done(function (data) {
        setTimeout(function () {
          children.prepend(element);
          $('#processing-modal').modal('toggle'); // after post
        }, 1000);
      });
    }

    event.preventDefault();
  });
}
